<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <title>Atualizar cliente</title>
</head>

<body>
    <h1>Atualizar cliente</h1>
    <%- include("partials/header") %>
        <div class="container mt-5 pt-5">
            <div class="row">
                <div class="col-12 col-sm-8 col-md-6 m-auto">
                    <div class="card my-2 py-2">
                        <h3 class="mx-auto"> <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30"
                                fill="currentColor" class="bi bi-person-check" viewBox="0 0 16 16">
                                <path
                                    d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7m1.679-4.493-1.335 2.226a.75.75 0 0 1-1.174.144l-.774-.773a.5.5 0 0 1 .708-.708l.547.548 1.17-1.951a.5.5 0 1 1 .858.514M11 5a3 3 0 1 1-6 0 3 3 0 0 1 6 0M8 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4" />
                                <path
                                    d="M8.256 14a4.5 4.5 0 0 1-.229-1.004H3c.001-.246.154-.986.832-1.664C4.484 10.68 5.711 10 8 10q.39 0 .74.025c.226-.341.496-.65.804-.918Q8.844 9.002 8 9c-5 0-6 3-6 4s1 1 1 1z" />
                            </svg> Editar </h3>
                        <div class="mb-3 card-body">
                            <form id="atualizaClienteForm" onsubmit="false">
                                <div class="form-row">
                                    <div class="col">
                                        <label for="nome2">Novo nome:</label>
                                        <input type="text" class="form-control mb-2" placeholder="novo nome aqui"
                                            name="nome" id="nome" value="<%= cliente.nome %>">
                                    </div>
                                    <div class="col">
                                        <label for="sobrenome">Sobrenome:</label>
                                        <input type="text" class="form-control" placeholder="Sobrenome" name="sobrenome" id="sobrenome" value="<%- cliente.sobrenome %>">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="email">Email:</label>
                                    <input type="email" class="form-control" id="email" placeholder="Email" name="email" value="<%- cliente.email %>">
                                </div>
                                <div class="form-group">
                                    <label for="tel">Telefone:</label>
                                    <input type="text" class="form-control" id="telefone" placeholder="(xx)xxxxxx-xxxx" name="telefone"  value="<%- cliente.telefone %>">
                                </div>
                                <div class="form-group col-md-6"></div>
                                <div class="form-group">
                                    <label for="endereco">Endereço:</label>
                                    <input type="text" class="form-control" id="endereco" placeholder="Avenida Saul Elkind nº 0" name="endereco" value="<%- cliente.endereco %>">
                                </div>
                                <div class="form-row">
                                    <div class="form-group col-md-6">
                                        <label for="cidade">Cidade:</label>
                                        <input type="text" class="form-control" id="cidade" name="cidade" required value="<%- cliente.cidade %>">
                                    </div>
                                    <div class="form-group col-md-4">
                                        <label for="estado">Estado:</label>
                                        <select id="estado" class="form-control" name="estado" required value="<%- cliente.estado %>">
                                            <option selected>Escolher...</option>
                                            <option value="ac">Acre (AC)</option>
                                            <option value="al">Alagoas (AL)</option>
                                            <option value="am">Amazonas (AM)</option>
                                            <option value="ba">Bahia (BA)</option>
                                            <option value="ce">Ceará (CE)</option>
                                            <option value="df">Distrito Federal (DF)</option>
                                            <option value="es">Espírito Santo (ES)</option>
                                            <option value="go">Goiás (GO)</option>
                                            <option value="ma">Maranhão (MA)</option>
                                            <option value="mt">Mato Grosso (MT)</option>
                                            <option value="ms">Mato Grosso do Sul (MS)</option>
                                            <option value="mg">Minas Gerais (MG)</option>
                                            <option value="pa">Pará (PA)</option>
                                            <option value="pb">Paraíba (PB)</option>
                                            <option value="pr">Paraná (PR)</option>
                                            <option value="pe">Pernambuco (PE)</option>
                                            <option value="pi">Piauí (PI)</option>
                                            <option value="rj">Rio de Janeiro (RJ)</option>
                                            <option value="rn">Rio Grande do Norte (RN)</option>
                                            <option value="rs">Rio Grande do Sul (RS)</option>
                                            <option value="ro">Rondônia (RO)</option>
                                            <option value="rr">Roraima (RR)</option>
                                            <option value="sc">Santa Catarina (SC)</option>
                                            <option value="sp">São Paulo (SP)</option>
                                            <option value="se">Sergipe (SE)</option>
                                            <option value="to">Tocantins (TO)</option>
                                        </select>
                                    </div>
                                    <div class="form-group col-md-2">
                                        <label for="cep">CEP:</label>
                                        <input type="text" class="form-control" id="cep" name="cep" value="<%- cliente.cep %>">
                                    </div>
                                </div>
                                </div>
                                <button type="submit" class="btn btn-primary mt-2">Atualizar Cadastro!</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script>
            document.getElementById('atualizaClienteForm').addEventListener('submit', function (event) {
            event.preventDefault(); 

            const cliId = '<%= cliente.id %>'; 
            const formData = {
                nome: document.getElementById('nome').value,
                sobrenome: document.getElementById('sobrenome').value,
                email: document.getElementById('email').value,
                telefone: document.getElementById('telefone').value,
                endereco: document.getElementById('endereco').value,
                cidade: document.getElementById('cidade').value,
                estado: document.getElementById('estado').value,
                cep: document.getElementById('cep').value,
            };
            fetch(`/cliente/${cliId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            })
                .then(response => {
                    if (response.ok) {
                        alert('Dados do cliente atualizados com sucesso!');
                        window.location.href = '/cliente'; 
                    } else {
                        alert('Erro ao atualizar dados do cliente.');
                    }
                })
                .catch(error => {
                    console.error('Erro na requisição:', error);
                    alert('Erro na requisição ao servidor.');
                });
        });
    </script>
</body>

</html>